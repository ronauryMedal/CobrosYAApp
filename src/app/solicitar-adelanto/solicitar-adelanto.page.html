<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab2"></ion-back-button>
    </ion-buttons>
    <ion-title>Solicitar Adelanto</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="container">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Información del Adelanto</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <form [formGroup]="adelantoForm" (ngSubmit)="solicitarAdelanto()">
                     <ion-grid>
             <ion-row>
               <!-- Columna Izquierda -->
               <ion-col size="12" size-md="6">
                 
                                                    <!-- Empleado (Primero) -->
                 <ion-item>
                   <ion-label position="stacked">Empleado</ion-label>
                   <ion-input 
                     formControlName="empleado" 
                     readonly 
                     placeholder="Cargando...">
                   </ion-input>
                   <ion-note slot="helper">Empleado logueado</ion-note>
                 </ion-item>

                                                    <!-- Monto Solicitado (Segundo) -->
                                   <ion-item [class.ion-invalid]="adelantoForm.get('montoSolicitado')?.invalid && adelantoForm.get('montoSolicitado')?.touched">
                   <ion-label position="stacked">Monto Solicitado *</ion-label>
                   <ion-input 
                     formControlName="montoSolicitado" 
                     type="number" 
                     placeholder="0"
                     (ionInput)="calcularMontoTotal()">
                   </ion-input>
                   <ion-note slot="helper">
                     <span *ngIf="limitesAdelanto">
                       Límite máximo: {{ formatearMoneda(montoMaximoSolicitable) }} ({{ limitesAdelanto?.porcentaje_maximo }}% del salario mensual)
                     </span>
                     <span *ngIf="!limitesAdelanto">Ingrese el monto que desea solicitar</span>
                   </ion-note>
                   <ion-note slot="error" *ngIf="adelantoForm.get('montoSolicitado')?.invalid && adelantoForm.get('montoSolicitado')?.touched">
                     {{ getMontoSolicitadoError() }}
                   </ion-note>
                 </ion-item>

                                  <!-- Tipo de Pago con Porcentaje (Tercero) -->
                 <ion-item>
                   <ion-label position="stacked">Tipo de Pago</ion-label>
                   <ion-input 
                     formControlName="tipoPago" 
                     readonly 
                     placeholder="Mensual (7% interés)">
                   </ion-input>
                   <ion-note slot="helper">Tipo por defecto: Mensual (7% interés)</ion-note>
                 </ion-item>

                                  <!-- Cantidad de Interés Calculada (Cuarto) -->
                 <ion-item class="highlighted-field">
                   <ion-label position="stacked">Cantidad de Interés</ion-label>
                   <ion-input 
                     formControlName="cantidadInteres" 
                     readonly 
                     type="number" 
                     placeholder="0.00"
                     class="calculated-value">
                   </ion-input>
                   <ion-note slot="helper">7% del monto solicitado</ion-note>
                 </ion-item>

                                                    <!-- Meses para Pagar -->
                 <ion-item>
                   <ion-label position="stacked">Meses para Pagar</ion-label>
                   <ion-input 
                     formControlName="mesesPago" 
                     readonly 
                     placeholder="1 mes">
                   </ion-input>
                   <ion-note slot="helper">Valor fijo: 1 mes</ion-note>
                 </ion-item>

                                  <!-- Fecha de Solicitud -->
                 <ion-item>
                   <ion-label position="stacked">Fecha de Solicitud</ion-label>
                   <ion-input 
                     formControlName="fechaSolicitud" 
                     readonly 
                     placeholder="19/08/2025">
                   </ion-input>
                   <ion-note slot="helper">Fecha automática de hoy</ion-note>
                 </ion-item>

                                  <!-- Observación -->
                 <ion-item>
                   <ion-label position="stacked">Observación</ion-label>
                   <ion-textarea 
                     formControlName="observacion" 
                     placeholder="Observaciones adicionales..."
                     rows="3">
                   </ion-textarea>
                 </ion-item>

                              </ion-col>
 
               <!-- Columna Derecha -->
               <ion-col size="12" size-md="6">
                 
                                  <!-- Monto Total -->
                 <ion-item class="highlighted-field">
                   <ion-label position="stacked">Monto Total</ion-label>
                   <ion-input 
                     formControlName="montoTotal" 
                     readonly 
                     type="number" 
                     placeholder="0.00"
                     class="calculated-value">
                   </ion-input>
                   <ion-note slot="helper">Monto solicitado + interés</ion-note>
                 </ion-item>

                                  <!-- Monto Mensual a Descontar -->
                 <ion-item class="highlighted-field">
                   <ion-label position="stacked">Monto Mensual a Descontar</ion-label>
                   <ion-input 
                     formControlName="montoMensual" 
                     readonly 
                     type="number" 
                     placeholder="0.00"
                     class="calculated-value">
                   </ion-input>
                   <ion-note slot="helper">Monto que se descontará mensualmente de la nómina</ion-note>
                 </ion-item>

                                  <!-- Estado (Oculto para empleado) -->
                 <ion-item style="display: none;">
                   <ion-label position="stacked">Estado</ion-label>
                   <ion-select formControlName="estado" placeholder="Pendiente">
                     <ion-select-option value="pendiente">Pendiente</ion-select-option>
                   </ion-select>
                 </ion-item>

                              </ion-col>
             </ion-row>
           </ion-grid>

          <!-- Botones -->
          <div class="form-actions">
            <ion-button expand="block" type="submit" [disabled]="!adelantoForm.valid">
              <ion-icon name="checkmark-outline" slot="start"></ion-icon>
              Solicitar Adelanto
            </ion-button>
            
            <ion-button expand="block" fill="outline" (click)="cancelar()">
              <ion-icon name="close-outline" slot="start"></ion-icon>
              Cancelar
            </ion-button>
          </div>
        </form>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
